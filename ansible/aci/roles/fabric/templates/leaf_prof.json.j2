{
  "infraNodeP": {
    "attributes": {
      "name": "{{ leaf_prof_name }}",
      "status": "{{ 'deleted' if leaf_prof.state == 'absent' else 'created,modified' }}"

      {% if leaf_prof.state == 'present' %}
      ,
      "descr": "{{ leaf_prof.description | default('') }}"
      {% endif %}
    }
    {% if leaf_prof.state == 'present' %}
    ,
    "children": [
      {% for block in leaf_prof.leaf_blocks | default( [] ) %}
      {
        "infraLeafS": {
          "attributes": {
            "name": "{{ block.name }}",
            "type": "range",
            "status": "{{ 'deleted' if range.state is defined and block.state == 'absent' else 'created,modified' }}"
            },
            "children": [
              {
                "infraNodeBlk": {
                  "attributes": {
                    "name": "{{ block.name }}",
                    "from_": "{{ block.from }}",
                    "to_": "{{ block.to }}",
                    "status": "{{ 'deleted' if block.state is defined and block.state == 'absent' else 'created,modified' }}"
                  }
                }
              }
            ]
        }
      }
      {% if not loop.last %},{% endif %}
      {% endfor %}

      {% if leaf_prof.leaf_blocks|default([])|length > 0 and leaf_prof.leaf_interface_profiles|default([])|length > 0 %},{% endif %}

      {% for leaf_intf_prof in leaf_prof.leaf_interface_profiles | default( [] ) %}
      {
        "infraRsAccPortP": {
          "attributes": {
            "tDn": "uni/infra/accportprof-{{ leaf_intf_prof.name }}",
            "status": "{{ 'deleted' if leaf_intf_prof.state is defined and leaf_intf_prof.state == 'absent' else 'created,modified' }}"
          }
        }
      }
      {% if not loop.last %},{% endif %}
      {% endfor %}

      {% if ( leaf_prof.ranges|default([])|length > 0 or leaf_prof.leaf_interface_profiles|default([])|length > 0 ) and leaf_prof.tags|default([])|length > 0  %},{% endif %}

      {% for tag in leaf_prof.tags | default( [] ) %}
      {
        "tagAnnotation": {
          "attributes": {
            "key": "{{ tag.name }}",
            "value": "{{ tag.value }}",
            "status": "{{ 'deleted' if tag.state is defined and tag.state == 'absent' else 'created,modified' }}"
          }
        }
      }
      {% if not loop.last %},{% endif %}
      {% endfor %}

    ]
    {% endif %}
  }
}